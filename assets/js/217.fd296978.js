(window.webpackJsonp=window.webpackJsonp||[]).push([[217],{593:function(t,s,a){"use strict";a.r(s);var e=a(4),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"docker-入门"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-入门"}},[t._v("#")]),t._v(" Docker 入门")]),t._v(" "),s("blockquote",[s("p",[t._v("本篇学习笔记文档对应 B 站视频："),s("a",{attrs:{href:"https://www.bilibili.com/video/BV1HP4118797?p=1&vd_source=d130139a92227a66fb558961b98507cb",target:"_blank",rel:"noopener noreferrer"}},[t._v("01.Docker课程介绍_bilibili"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),s("blockquote",[s("p",[t._v("问题")])]),t._v(" "),s("p",[t._v("在 Linux 上部署一个单体项目大多数同学都会有相同的感受，那就是"),s("strong",[t._v("麻烦")]),t._v("。核心体现在三点：")]),t._v(" "),s("ul",[s("li",[t._v("命令太多了，记不住")]),t._v(" "),s("li",[t._v("软件安装包名字复杂，不知道去哪里找")]),t._v(" "),s("li",[t._v("安装和部署步骤复杂，容易出错")])]),t._v(" "),s("p",[t._v("其实上述问题不仅仅是新手，即便是运维在安装、部署的时候一样会觉得麻烦、容易出错。")]),t._v(" "),s("p",[t._v("特别是微服务阶段，微服务项目动辄就是几十台、上百台服务需要部署，有些大型项目甚至达到数万台服务。而"),s("strong",[t._v("由于每台服务器的运行环境不同，你写好的安装流程、部署脚本并不一定在每个服务器都能正常运行")]),t._v("，经常会出错。这就给系统的部署运维带来了很多困难。")]),t._v(" "),s("blockquote",[s("p",[t._v("解决方案")])]),t._v(" "),s("p",[s("em",[t._v("那么，有没有一种技术能够避免部署对服务器环境的依赖，减少复杂的部署流程呢？")])]),t._v(" "),s("p",[t._v("答案是肯定的，这就是 "),s("strong",[t._v("Docker")]),t._v(" 技术。你会发现，有了 Docker 以后项目的部署如丝般顺滑，大大减少了运维工作量。")]),t._v(" "),s("p",[t._v("即便你对 Linux 不熟悉，你也能"),s("strong",[t._v("轻松部署各种常见软件、Java 项目")]),t._v("。")]),t._v(" "),s("p",[t._v("通过今天的学习，希望大家能达成下面的"),s("strong",[t._v("学习目标")]),t._v("：⭐️")]),t._v(" "),s("ul",[s("li",[t._v("能利用 Docker 部署常见软件")]),t._v(" "),s("li",[t._v("能利用 Docker 打包并部署 Java 应用")]),t._v(" "),s("li",[t._v("理解 Docker 数据卷的基本作用")]),t._v(" "),s("li",[t._v("能看懂 DockerCompose 文件")])]),t._v(" "),s("h2",{attrs:{id:"_1-快速入门"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-快速入门"}},[t._v("#")]),t._v(" 1.快速入门")]),t._v(" "),s("p",[t._v("要想让 Docker 帮我们安装和部署软件，肯定要保证你的机器上有 Docker. 由于大家的操作系统各不相同，安装方式也不同。为了便于大家学习，我们统一在 CentOS 的虚拟机中安装 Docker，统一学习环境。")]),t._v(" "),s("blockquote",[s("p",[t._v("注意：使用 MacBook 的同学也请利用 VMwareFusion 来安装虚拟机，并在虚拟机中学习 Docker 使用。")])]),t._v(" "),s("p",[t._v("安装方式参考文档："),s("a",{attrs:{href:"https://cmty256.github.io/pages/44a072/",target:"_blank",rel:"noopener noreferrer"}},[t._v("《安装Docker》"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"_1-1-部署-mysql"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-部署-mysql"}},[t._v("#")]),t._v(" 1.1.部署 MySQL")]),t._v(" "),s("p",[t._v("首先，我们利用 Docker 来安装一个 MySQL 软件，大家可以对比一下之前传统的安装方式，看看哪个效率更高一些。")]),t._v(" "),s("p",[t._v("如果是利用传统方式部署 MySQL，大概的步骤有：")]),t._v(" "),s("ul",[s("li",[t._v("搜索并下载 MySQL 安装包")]),t._v(" "),s("li",[t._v("上传至 Linux 环境")]),t._v(" "),s("li",[t._v("编译和配置环境")]),t._v(" "),s("li",[t._v("安装")])]),t._v(" "),s("p",[t._v("而使用 Docker 安装，仅仅需要一步即可，在命令行输入下面的命令（建议采用CV大法）：")]),t._v(" "),s("div",{staticClass:"language-PowerShell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("docker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("name mysql \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p 3306:3306 \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e TZ=Asia/Shanghai \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e MYSQL_ROOT_PASSWORD=123456 \\\n  mysql\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("p",[t._v("运行效果如图：")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cmty256.github.io/picx-images-hosting/microservice/image.2obaqzglo7.webp",loading:"lazy"}})]),t._v(" "),s("p",[t._v("MySQL 安装完毕！通过任意客户端工具即可连接到 MySQL.")]),t._v(" "),s("p",[t._v("大家可以发现，当我们执行命令后，Docker 做的第一件事情，是去自动搜索并下载了 MySQL，然后会自动运行 MySQL，我们完全不用插手，是不是非常方便。")]),t._v(" "),s("p",[t._v("而且，这种安装方式你完全不用考虑运行的操作系统环境，它不仅仅在 CentOS 系统是这样，在 Ubuntu 系统、macOS 系统、甚至是装了 WSL 的 Windows 下，都可以使用这条命令来安装 MySQL。")]),t._v(" "),s("p",[t._v("要知道，"),s("strong",[t._v("不同操作系统下其安装包、运行环境是都不相同的")]),t._v("！如果是"),s("strong",[t._v("手动安装，必须手动解决安装包不同、环境不同的、配置不同的问题")]),t._v("！")]),t._v(" "),s("p",[t._v("而使用 Docker，这些完全不用考虑。就是因为 Docker 会自动搜索并下载 MySQL。注意：这里下载的不是安装包，而是"),s("strong",[t._v("镜像。"),s("strong",[t._v("镜像中不仅包含了 MySQL本身，还包含了其运行所需要的环境、配置、系统级函数库。因此它在运行时就有自己独立的环境，就可以跨系统运行，也不需要手动再次配置环境了。这套独立运行的隔离环境我们称为")]),t._v("容器")]),t._v("。")]),t._v(" "),s("p",[t._v("说明：")]),t._v(" "),s("ul",[s("li",[t._v("镜像：英文是 image")]),t._v(" "),s("li",[t._v("容器：英文是 container")])]),t._v(" "),s("blockquote",[s("p",[t._v("因此，Docker 安装软件的过程，就是自动搜索下载镜像，然后创建并运行容器的过程。（类似绿色免安装版软件下载，可直接运行）")])]),t._v(" "),s("p",[t._v("Docker 会根据命令中的镜像名称自动搜索并下载镜像，那么问题来了，它是去哪里搜索和下载镜像的呢？这些镜像又是谁制作的呢？")]),t._v(" "),s("ul",[s("li",[t._v("Docker 官方提供了一个专门管理、存储镜像的网站，并对外开放了镜像上传、下载的权利。")]),t._v(" "),s("li",[t._v("Docker官方提供了一些基础镜像，然后各大软件公司又在基础镜像基础上，制作了自家软件的镜像，全部都存放在这个网站。")]),t._v(" "),s("li",[t._v("这个网站就成了 Docker 镜像交流的社区："),s("a",{attrs:{href:"https://hub.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://hub.docker.com/"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("基本上我们常用的各种软件都能在这个网站上找到，我们甚至可以自己制作镜像上传上去。")]),t._v(" "),s("p",[t._v("像这种提供存储、管理 Docker 镜像的服务器，被称为 DockerRegistry，可以翻译为镜像仓库。DockerHub 网站是官方仓库，阿里云、华为云会提供一些第三方仓库，我们也可以自己搭建私有的镜像仓库。")]),t._v(" "),s("p",[t._v("官方仓库在国外，下载速度较慢，一般我们都会使用第三方仓库提供的镜像加速功能，提高下载速度。而企业内部的机密项目，往往会采用私有镜像仓库。")]),t._v(" "),s("p",[t._v("总之，镜像的来源有两种：")]),t._v(" "),s("ul",[s("li",[t._v("基于官方基础镜像自己制作")]),t._v(" "),s("li",[t._v("直接去 DockerRegistry 下载")])]),t._v(" "),s("p",[s("strong",[t._v("总结一下")]),t._v("：")]),t._v(" "),s("p",[t._v("Docker 本身包含一个后台服务，我们可以利用 Docker 命令告诉 Docker 服务，帮助我们快速部署指定的应用。Docker 服务部署应用时，首先要去搜索并下载应用对应的镜像，然后根据镜像创建并允许容器，应用就部署完成了。")]),t._v(" "),s("p",[s("strong",[t._v("用一幅图标示如下：")])]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"download","data-src":"https://cmty256.github.io/picx-images-hosting/microservice/download.2ruwonmdi6.webp",loading:"lazy"}})]),t._v(" "),s("h3",{attrs:{id:"_1-2-命令解读"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-命令解读"}},[t._v("#")]),t._v(" 1.2.命令解读")]),t._v(" "),s("p",[t._v("利用 Docker 快速的安装了 MySQL，非常的方便，不过我们执行的命令到底是什么意思呢？")]),t._v(" "),s("div",{staticClass:"language-PowerShell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("docker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("name mysql \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p 3306:3306 \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e TZ=Asia/Shanghai \\\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("e MYSQL_ROOT_PASSWORD=123456 \\\n  mysql\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("blockquote",[s("p",[t._v("解读：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("docker run -d")]),t._v(" ：创建并运行一个容器，"),s("code",[t._v("-d")]),t._v("（detached mode）则是让容器以后台进程运行")]),t._v(" "),s("li",[s("code",[t._v("--name mysql")]),t._v(" : 给容器起个名字叫 "),s("code",[t._v("mysql")]),t._v("，你可以叫别的（必须唯一）")]),t._v(" "),s("li",[s("code",[t._v("-p 3306:3306")]),t._v(" : 设置端口映射。\n"),s("ul",[s("li",[s("strong",[t._v("容器是隔离环境")]),t._v("，外界不可访问。但是可以"),s("strong",[t._v("将宿主机端口映射容器内到端口")]),t._v("，当访问宿主机指定端口时，就是在访问容器内的端口了。")]),t._v(" "),s("li",[t._v("容器内端口往往是由容器内的进程决定，例如MySQL进程默认端口是3306，因此容器内端口一定是 3306；而宿主机端口则可以任意指定，一般与容器内保持一致。")]),t._v(" "),s("li",[t._v("格式： "),s("code",[t._v("-p 宿主机端口:容器内端口")]),t._v("，示例中就是将宿主机的3306映射到容器内的3306端口")])])]),t._v(" "),s("li",[s("code",[t._v("-e TZ=Asia/Shanghai")]),t._v(" : 配置容器内进程运行时的一些参数（环境变量）\n"),s("ul",[s("li",[t._v("格式："),s("code",[t._v("-e KEY=VALUE")]),t._v("，KEY和VALUE都由容器内进程决定")]),t._v(" "),s("li",[t._v("案例中，"),s("code",[t._v("TZ=Asia/Shanghai")]),t._v(" 是设置时区；"),s("code",[t._v("MYSQL_ROOT_PASSWORD=123456")]),t._v(" 是设置 MySQL 默认密码")])])]),t._v(" "),s("li",[s("code",[t._v("mysql")]),t._v(" : 设置"),s("strong",[t._v("镜像")]),t._v("名称，Docker 会根据这个名字搜索并下载镜像\n"),s("ul",[s("li",[t._v("镜像名称一般分两部分组成："),s("code",[t._v("[REPOSITORY]:[TAG]")]),t._v("，例如 "),s("code",[t._v("mysql:8.0")]),t._v("，其中 "),s("code",[t._v("REPOSITORY")]),t._v(" 可以理解为"),s("strong",[t._v("镜像名")]),t._v("，"),s("code",[t._v("TAG")]),t._v(" 是"),s("strong",[t._v("版本号")])]),t._v(" "),s("li",[t._v("在未指定 "),s("code",[t._v("TAG")]),t._v(" 的情况下，默认是最新版本，也就是 "),s("code",[t._v("mysql:latest")])])])])])]),t._v(" "),s("p",[t._v("镜像的名称不是随意的，而是要到 DockerRegistry 中寻找，镜像运行时的配置也不是随意的，要参考镜像的帮助文档，这些在 DockerHub 网站或者软件的官方网站中都能找到。")]),t._v(" "),s("p",[t._v("如果我们要安装其它软件，也可以到 DockerRegistry 中寻找对应的镜像名称和版本，阅读相关配置即可。")]),t._v(" "),s("h3",{attrs:{id:"_1-3-docker-run-命令中的常见参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-docker-run-命令中的常见参数"}},[t._v("#")]),t._v(" 1.3 docker run 命令中的常见参数")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("-d")]),t._v(" : 让容器后台运行")]),t._v(" "),s("li",[s("code",[t._v("--name")]),t._v(" : 给容器命名")]),t._v(" "),s("li",[s("code",[t._v("-e")]),t._v(" ： 环境变量")]),t._v(" "),s("li",[s("code",[t._v("-p")]),t._v(" : 宿主端口映射到容器内端口")]),t._v(" "),s("li",[s("code",[t._v("[repository]:[tag]")]),t._v(" : 镜像名称结构，【镜像名】:【版本号】，【版本号】可不指定，默认最新版本（"),s("code",[t._v("latest")]),t._v("）")])]),t._v(" "),s("h2",{attrs:{id:"_2-docker-基础"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-docker-基础"}},[t._v("#")]),t._v(" 2.Docker 基础")]),t._v(" "),s("p",[t._v("接下来，我们一起来学习 Docker 使用的一些基础知识，为将来部署项目打下基础。具体用法可以参考 Docker 官方文档：")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://docs.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.docker.com/"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"_2-1-常见命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-常见命令"}},[t._v("#")]),t._v(" 2.1.常见命令")]),t._v(" "),s("p",[t._v("首先我们来学习 Docker 中的常见命令，可以参考官方文档：")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/cli/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.docker.com/engine/reference/commandline/cli/"),s("OutboundLink")],1)]),t._v(" "),s("h4",{attrs:{id:"_2-1-1-命令介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-命令介绍"}},[t._v("#")]),t._v(" 2.1.1.命令介绍")]),t._v(" "),s("p",[t._v("其中，比较常见的命令有：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("命令")])]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("说明")])]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("文档地址")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker pull")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("拉取镜像")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/pull/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker pull"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker push")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("推送镜像到DockerRegistry")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/push/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker push"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker images")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("查看本地镜像")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/images/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker images"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker rmi")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("删除本地镜像")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/rmi/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker rmi"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker run")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("创建并运行容器（不能重复创建）")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/run/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker run"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker stop")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("停止指定容器")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/stop/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker stop"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker start")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("启动指定容器")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/start/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker start"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker restart")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("重新启动容器")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/restart/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker restart"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker rm")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("删除指定容器")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/rm/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docs.docker.com"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker ps")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("查看容器")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/ps/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker ps"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker logs")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("查看容器运行日志")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/logs/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker logs"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker exec")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("进入容器")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/exec/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker exec"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker save")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("保存镜像到本地压缩文件")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/save/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker save"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker load")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("加载本地压缩文件到镜像")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/load/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker load"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker inspect")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("查看容器详细信息")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/inspect/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker inspect"),s("OutboundLink")],1)])])])]),t._v(" "),s("p",[s("strong",[t._v("用一副图来表示这些命令的关系")]),t._v("：")]),t._v(" "),s("p",[t._v("补充：")]),t._v(" "),s("p",[t._v("默认情况下，每次重启虚拟机我们都需要手动启动 Docker 和 Docker 中的容器。通过命令可以实现开机自启：")]),t._v(" "),s("div",{staticClass:"language-PowerShell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Docker开机自启")]),t._v("\nsystemctl enable docker\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Docker容器开机自启")]),t._v("\ndocker update "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("restart=always "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("容器名"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("容器id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 例如：docker update --restart=always mysql")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("h4",{attrs:{id:"_2-1-2-演示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-演示"}},[t._v("#")]),t._v(" 2.1.2.演示")]),t._v(" "),s("p",[t._v("教学环节说明：我们以 Nginx 为例给大家演示上述命令。")]),t._v(" "),s("div",{staticClass:"language-PowerShell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第1步，去DockerHub查看nginx镜像仓库及相关信息")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第2步，拉取Nginx镜像")]),t._v("\ndocker pull nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第3步，查看镜像")]),t._v("\ndocker images\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果如下：")]),t._v("\nREPOSITORY   TAG       IMAGE ID       CREATED         SIZE\nnginx        latest    605c77e624dd   16 months ago   141MB\nmysql        latest    3218b38490ce   17 months ago   516MB\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第4步，创建并允许Nginx容器")]),t._v("\ndocker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("name nginx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p 80:80 nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第5步，查看运行中容器")]),t._v("\ndocker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 也可以加格式化方式访问，格式会更加清爽")]),t._v("\ndocker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("format "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"table {{.ID}}\\t{{.Image}}\\t{{.Ports}}\\t{{.Status}}\\t{{.Names}}"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第6步，访问网页，地址：http://虚拟机地址")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第7步，停止容器")]),t._v("\ndocker stop nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第8步，查看所有容器")]),t._v("\ndocker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("a "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("format "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"table {{.ID}}\\t{{.Image}}\\t{{.Ports}}\\t{{.Status}}\\t{{.Names}}"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第9步，再次启动nginx容器")]),t._v("\ndocker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),t._v(" nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第10步，再次查看容器")]),t._v("\ndocker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("format "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"table {{.ID}}\\t{{.Image}}\\t{{.Ports}}\\t{{.Status}}\\t{{.Names}}"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker logs -f nginx == [-f] 代表持续查看该镜像的日志")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第11步，查看容器详细信息")]),t._v("\ndocker inspect nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第12步，进入容器,查看容器内目录（可以按 Ctrl+D 或输入 exit 来退出）")]),t._v("\ndocker exec "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("it nginx bash\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或者，可以进入MySQL")]),t._v("\ndocker exec "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("it mysql mysql "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("uroot "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 第13步，删除容器")]),t._v("\ndocker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" nginx\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 发现无法删除，因为容器运行中，强制删除容器")]),t._v("\ndocker "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f nginx\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br"),s("span",{staticClass:"line-number"},[t._v("46")]),s("br"),s("span",{staticClass:"line-number"},[t._v("47")]),s("br"),s("span",{staticClass:"line-number"},[t._v("48")]),s("br")])]),s("h4",{attrs:{id:"_2-1-3-镜像删除"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-镜像删除"}},[t._v("#")]),t._v(" 2.1.3.镜像删除")]),t._v(" "),s("p",[t._v("一、强制删除：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" image "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("镜像名/镜像id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 也可指定版本删除")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" image "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("镜像名/镜像id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("版本号"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除之后还需要删除容器才能重新执行第二个")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("容器名"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("p",[t._v("二、如果您想要删除所有未使用的镜像，你可以使用 "),s("code",[t._v("docker image prune")]),t._v(" 命令。这个命令会删除所有没有被任何容器引用的镜像，释放磁盘空间：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" image prune\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("执行这个命令后，Docker 会询问您是否确认删除这些镜像。如果您确定要删除，请输入 "),s("code",[t._v("y")]),t._v(" 并按回车键。")]),t._v(" "),s("h4",{attrs:{id:"_2-1-4-命令别名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-4-命令别名"}},[t._v("#")]),t._v(" 2.1.4.命令别名")]),t._v(" "),s("p",[t._v("给常用 Docker 命令起别名，方便我们访问：")]),t._v(" "),s("div",{staticClass:"language-PowerShell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改/root/.bashrc文件")]),t._v("\nvi "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("root/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bashrc\n内容如下：\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# .bashrc")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# User specific aliases and functions")]),t._v("\n\nalias "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v("="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rm -i'")]),t._v("\nalias "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v("="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cp -i'")]),t._v("\nalias "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v("="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mv -i'")]),t._v("\nalias dps="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'docker ps --format \"table {{.ID}}\\t{{.Image}}\\t{{.Ports}}\\t{{.Status}}\\t{{.Names}}\"'")]),t._v("\nalias dis="),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'docker images'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Source global definitions")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/bashrc "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" then\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc/bashrc\nfi\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br")])]),s("p",[t._v("修改之后，保存并退出")]),t._v(" "),s("div",{staticClass:"language-powershell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v(":wq\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("然后，执行命令使别名生效")]),t._v(" "),s("div",{staticClass:"language-PowerShell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("source "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("root/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("bashrc\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("接下来，试试看新的命令吧。")]),t._v(" "),s("h3",{attrs:{id:"_2-2-数据卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-数据卷"}},[t._v("#")]),t._v(" 2.2.数据卷")]),t._v(" "),s("p",[t._v("容器是隔离环境，容器内程序的文件、配置、运行时产生的容器都在容器内部，我们要读写容器内的文件非常不方便。大家思考几个问题：")]),t._v(" "),s("ul",[s("li",[t._v("如果要升级 MySQL 版本，需要销毁旧容器，那么数据岂不是跟着被销毁了？")]),t._v(" "),s("li",[t._v("MySQL、Nginx 容器运行后，如果我要修改其中的某些配置该怎么办？")]),t._v(" "),s("li",[t._v("我想要让 Nginx 代理我的静态资源怎么办？")])]),t._v(" "),s("p",[t._v("因此，容器提供程序的运行环境，但是"),s("strong",[t._v("程序运行产生的数据、程序运行依赖的配置都应该与容器解耦")]),t._v("。")]),t._v(" "),s("h4",{attrs:{id:"_2-2-1-什么是数据卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-什么是数据卷"}},[t._v("#")]),t._v(" 2.2.1.什么是数据卷")]),t._v(" "),s("p",[s("strong",[t._v("数据卷（volume）"),s("strong",[t._v("是一个虚拟目录，是")]),t._v("容器内目录")]),t._v("与"),s("strong",[t._v("宿主机目录")]),t._v("之间映射的桥梁。")]),t._v(" "),s("p",[t._v("以 Nginx 为例，我们知道 Nginx 中有两个关键的目录：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("html")]),t._v("：放置一些静态资源")]),t._v(" "),s("li",[s("code",[t._v("conf")]),t._v("：放置配置文件")])]),t._v(" "),s("p",[t._v("如果我们要让 Nginx 代理我们的静态资源，最好是放到"),s("code",[t._v("html")]),t._v("目录；如果我们要修改 Nginx 的配置，最好是找到 "),s("code",[t._v("conf")]),t._v(" 下的 "),s("code",[t._v("nginx.conf")]),t._v(" 文件。")]),t._v(" "),s("p",[t._v("但遗憾的是，容器运行的 Nginx 所有的文件都在容器内部。所以我们必须利用数据卷将两个目录与宿主机目录关联，方便我们操作。如图：")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cmty256.github.io/picx-images-hosting/microservice/image.lvi2xkzph.webp",loading:"lazy"}})]),t._v(" "),s("p",[t._v("在上图中：")]),t._v(" "),s("ul",[s("li",[t._v("我们创建了两个数据卷："),s("code",[t._v("conf")]),t._v("、"),s("code",[t._v("html")])]),t._v(" "),s("li",[t._v("Nginx 容器内部的 "),s("code",[t._v("conf")]),t._v(" 目录和 "),s("code",[t._v("html")]),t._v(" 目录分别与两个数据卷关联。")]),t._v(" "),s("li",[t._v("而数据卷 conf 和 html 分别指向了宿主机的 "),s("code",[t._v("/var/lib/docker/volumes/conf/_data")]),t._v(" 目录和 "),s("code",[t._v("/var/lib/docker/volumes/html/_data")]),t._v(" 目录")])]),t._v(" "),s("p",[t._v("这样一来，容器内的 "),s("code",[t._v("conf")]),t._v(" 和 "),s("code",[t._v("html")]),t._v(" 目录就 与宿主机的 "),s("code",[t._v("conf")]),t._v(" 和 "),s("code",[t._v("html")]),t._v(" 目录关联起来，我们称为【"),s("strong",[t._v("挂载")]),t._v("】。")]),t._v(" "),s("p",[t._v("此时，我们操作宿主机的 "),s("code",[t._v("/var/lib/docker/volumes/html/_data")]),t._v(" 就是在操作容器内的 "),s("code",[t._v("/usr/share/nginx/html/_data")]),t._v(" 目录。只要我们将静态资源放入宿主机对应目录，就可以被 Nginx 代理了。")]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("/var/lib/docker/volumes")]),t._v(" 这个目录就是默认的存放所有容器数据卷的目录，其下再根据数据卷名称创建新目录，格式为 "),s("code",[t._v("/数据卷名/_data")]),t._v("。")])]),t._v(" "),s("p",[s("strong",[t._v("为什么不让容器目录直接指向宿主机目录呢？")])]),t._v(" "),s("ul",[s("li",[t._v("因为直接指向宿主机目录就与宿主机强耦合了，如果切换了环境，宿主机目录就可能发生改变了。由于容器一旦创建，目录挂载就无法修改，这样容器就无法正常工作了。")]),t._v(" "),s("li",[t._v("但是容器指向数据卷，一个逻辑名称，而数据卷再指向宿主机目录，就不存在强耦合。如果宿主机目录发生改变，只要改变数据卷与宿主机目录之间的映射关系即可。")])]),t._v(" "),s("blockquote",[s("p",[t._v("⚠️不过，我们通过由于数据卷目录比较深，不好寻找，通常我们也"),s("strong",[t._v("允许让容器直接与宿主机目录挂载而不使用数据卷")]),t._v("，具体参考 2.2.3 小节。")])]),t._v(" "),s("h4",{attrs:{id:"_2-2-2-数据卷命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-数据卷命令"}},[t._v("#")]),t._v(" 2.2.2.数据卷命令")]),t._v(" "),s("p",[t._v("数据卷的相关命令有：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("命令")])]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("说明")])]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("文档地址")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker volume create")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("创建数据卷")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/volume_create/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker volume create"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker volume ls")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("查看所有数据卷")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/volume_ls/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docs.docker.com"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker volume rm")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("删除指定数据卷")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/volume_prune/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docs.docker.com"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker volume inspect")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("查看某个数据卷的详情")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/volume_inspect/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docs.docker.com"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker volume prune")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("清除数据卷")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/volume_prune/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker volume prune"),s("OutboundLink")],1)])])])]),t._v(" "),s("p",[t._v("注意：容器与数据卷的挂载要在创建容器时配置，对于创建好的容器，是不能设置数据卷的。而且"),s("strong",[t._v("创建容器的过程中，数据卷会自动创建")]),t._v("。")]),t._v(" "),s("p",[t._v("教学"),s("strong",[t._v("演示环节")]),t._v("：演示一下 nginx 的 html 目录挂载")]),t._v(" "),s("div",{staticClass:"language-PowerShell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.首先创建容器并指定数据卷，注意通过 -v 参数来指定数据卷")]),t._v("\ndocker run "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("name nginx "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("p 80:80 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("v html:"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr/share/nginx/html nginx\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2.然后查看数据卷")]),t._v("\ndocker volume "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\nDRIVER    VOLUME NAME\nlocal     29524ff09715d3688eae3f99803a2796558dbd00ca584a25a4bbc193ca82459f\nlocal     html\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.查看数据卷详情")]),t._v("\ndocker volume inspect html\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CreatedAt"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2024-05-17T19:57:08+08:00"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Driver"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"local"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Labels"')]),t._v(": null"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mountpoint"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/docker/volumes/html/_data"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Name"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"html"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Options"')]),t._v(": null"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Scope"')]),t._v(": "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"local"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4.查看/var/lib/docker/volumes/html/_data目录")]),t._v("\nll "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("lib/docker/volumes/html/_data\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 可以看到与nginx的html目录内容一样，结果如下：")]),t._v("\n总用量 8\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rw-r-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("r-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" 1 root root 497 12月 28 2021 50x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("rw-r-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("r-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" 1 root root 615 12月 28 2021 index"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 5.进入该目录，并随意修改index.html内容")]),t._v("\ncd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("lib/docker/volumes/html/_data\nvi index"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 6.打开页面，查看效果")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 7.进入容器内部，查看/usr/share/nginx/html目录内的文件是否变化")]),t._v("\ndocker exec "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("it nginx bash\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br")])]),s("h5",{attrs:{id:"匿名数据卷"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#匿名数据卷"}},[t._v("#")]),t._v(" 匿名数据卷")]),t._v(" "),s("p",[t._v("教学"),s("strong",[t._v("演示环节")]),t._v("：演示一下MySQL的匿名数据卷")]),t._v(" "),s("div",{staticClass:"language-PowerShell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.查看MySQL容器详细信息")]),t._v("\ndocker inspect mysql\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关注其中.Config.Volumes部分和.Mounts部分")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[t._v("我们关注两部分内容，第一是"),s("code",[t._v(".Config.Volumes")]),t._v("部分：")]),t._v(" "),s("div",{staticClass:"language-JSON line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Config"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ... 略")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Volumes"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"/var/lib/mysql"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ... 略")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])]),s("p",[t._v("可以发现这个容器声明了一个本地目录，需要挂载数据卷，但是"),s("strong",[t._v("数据卷未定义")]),t._v("。这就是匿名卷。")]),t._v(" "),s("p",[t._v("然后，我们再看结果中的"),s("code",[t._v(".Mounts")]),t._v("部分：")]),t._v(" "),s("div",{staticClass:"language-JSON line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Mounts"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Type"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"volume"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"29524ff09715d3688eae3f99803a2796558dbd00ca584a25a4bbc193ca82459f"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Source"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/docker/volumes/29524ff09715d3688eae3f99803a2796558dbd00ca584a25a4bbc193ca82459f/_data"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Destination"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/mysql"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Driver"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"local"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])]),s("p",[t._v("可以发现，其中有几个关键属性：")]),t._v(" "),s("ul",[s("li",[t._v("Name：数据卷名称。由于定义容器未设置容器名，这里的就是匿名卷自动生成的名字，一串hash值。")]),t._v(" "),s("li",[t._v("Source：宿主机目录")]),t._v(" "),s("li",[t._v("Destination : 容器内的目录")])]),t._v(" "),s("p",[t._v("上述配置是将容器内的 "),s("code",[t._v("/var/lib/mysql")]),t._v(" 这个目录，与数据卷 "),s("code",[t._v("29524ff09715d3688eae3f99803a2796558dbd00ca584a25a4bbc193ca82459f")]),t._v(" 挂载。")]),t._v(" "),s("p",[t._v("于是在宿主机中就有了 "),s("code",[t._v("/var/lib/docker/volumes/29524ff09715d3688eae3f99803a2796558dbd00ca584a25a4bbc193ca82459f/_data")]),t._v(" 这个目录。这就是匿名数据卷对应的目录，其使用方式与普通数据卷没有差别。")]),t._v(" "),s("p",[t._v("接下来，可以查看该目录下的 MySQL 的 data 文件：")]),t._v(" "),s("div",{staticClass:"language-Bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" /var/lib/docker/volumes/29524ff09715d3688eae3f99803a2796558dbd00ca584a25a4bbc193ca82459f/_data\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" /var/lib/docker/volumes/066d3ac65581fbf24492b9ed3690d6c42c9e923266a1666fda6ce6058703953d/_data\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[t._v("注意：每一个不同的镜像，将来创建容器后内部有哪些目录可以挂载，可以参考DockerHub对应的页面")]),t._v(" "),s("h4",{attrs:{id:"_2-2-3-挂载本地目录或文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-挂载本地目录或文件"}},[t._v("#")]),t._v(" 2.2.3.挂载本地目录或文件")]),t._v(" "),s("p",[t._v("可以发现，数据卷的目录结构较深，如果我们去操作数据卷目录会不太方便。在很多情况下，我们会直接将容器目录与宿主机指定目录挂载。挂载语法与数据卷类似：")]),t._v(" "),s("div",{staticClass:"language-Bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 挂载本地目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" 本地目录:容器内目录\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 挂载本地文件")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" 本地文件:容器内文件\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("blockquote",[s("p",[t._v("⚠️"),s("strong",[t._v("注意")]),t._v("：本地目录或文件必须以 "),s("code",[t._v("/")]),t._v(" 或 "),s("code",[t._v("./")]),t._v("开头，如果直接以名字开头，会被识别为数据卷名而非本地目录名。")])]),t._v(" "),s("p",[t._v("例如：")]),t._v(" "),s("div",{staticClass:"language-Bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" mysql:/var/lib/mysql "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 会被识别为一个数据卷叫mysql，运行时会自动创建这个数据卷（匿名数据卷）")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" ./software/mysql:/var/lib/mysql "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 会被识别为当前目录下的mysql目录，运行时如果不存在会创建目录")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[s("strong",[t._v("教学演示")]),t._v("，删除并重新创建 mysql 容器，并完成本地目录挂载：")]),t._v(" "),s("ul",[s("li",[t._v("挂载"),s("code",[t._v("/root/software/mysql/data")]),t._v("到容器内的"),s("code",[t._v("/var/lib/mysql")]),t._v("目录")]),t._v(" "),s("li",[t._v("挂载"),s("code",[t._v("/root/software/mysql/init")]),t._v("到容器内的"),s("code",[t._v("/docker-entrypoint-initdb.d")]),t._v("目录（初始化的 SQL 脚本目录）")]),t._v(" "),s("li",[t._v("挂载"),s("code",[t._v("/root/software/mysql/conf")]),t._v("到容器内的"),s("code",[t._v("/etc/mysql/conf.d")]),t._v("目录（这个是 MySQL 配置文件目录）")])]),t._v(" "),s("p",[t._v("进入 "),s("code",[t._v("/root/software/mysql/conf")]),t._v(" 目录，新建 "),s("code",[t._v("my.cnf")]),t._v(" 配置文件：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这里主要是配置了 MySQL 的默认编码")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("client"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("default_character_set")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("default_character_set")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mysqld"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("character_set_server")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("collation_server")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("utf8mb4_unicode_ci\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("init_connect")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SET NAMES utf8mb4'")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])]),s("p",[t._v("接下来，我们演示本地目录挂载：")]),t._v(" "),s("div",{staticClass:"language-Bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.删除原来的MySQL容器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" mysql\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2.进入root目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" ~\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.创建并运行新mysql容器，挂载本地目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" mysql "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v(":3306 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("TZ")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Asia/Shanghai "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" ./software/mysql/data:/var/lib/mysql "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" ./software/mysql/conf:/etc/mysql/conf.d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" ./software/mysql/init:/docker-entrypoint-initdb.d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  mysql\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" mysql "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4417")]),t._v(":3306 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("TZ")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Asia/Shanghai "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" ./software/mysql/data:/var/lib/mysql "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" ./software/mysql/conf:/etc/mysql/conf.d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" ./software/mysql/init:/docker-entrypoint-initdb.d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  mysql\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4.查看root目录，可以发现~/mysql/data目录已经自动创建好了")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" ./software/mysql\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果：")]),t._v("\n总用量 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\ndrwxr-xr-x. "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root    root   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("月  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":11 conf\ndrwxr-xr-x. "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v(" polkitd root "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("月  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":11 data\ndrwxr-xr-x. "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" root    root   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("月  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(":11 init\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看data目录，会发现里面有大量数据库数据，说明数据库完成了初始化")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-l")]),t._v(" data\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 5.查看MySQL容器内数据")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 5.1.进入MySQL")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" mysql mysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-uroot")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p123456")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 5.2.查看编码表")]),t._v("\nshow variables like "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%char%"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 5.3.结果，发现编码是utf8mb4没有问题。（如果不加配置文件，会发现client、connection、results的编码是latin1） ")]),t._v("\n+--------------------------+--------------------------------+\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Variable_name            "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Value                          "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+--------------------------+--------------------------------+\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_client     "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" utf8mb4                        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_connection "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" utf8mb4                        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_database   "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" utf8mb4                        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_filesystem "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" binary                         "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_results    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" utf8mb4                        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_server     "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" utf8mb4                        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_set_system     "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" utf8mb3                        "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" character_sets_dir       "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" /usr/share/mysql-8.0/charsets/ "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+--------------------------+--------------------------------+\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 6.查看数据")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 6.1.查看数据库")]),t._v("\nshow databases"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果，hmall是黑马商城数据库")]),t._v("\n+--------------------+\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Database           "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+--------------------+\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" information_schema "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" mysql              "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" performance_schema "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" sys                "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+--------------------+\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" rows "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("set")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.00")]),t._v(" sec"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br"),s("span",{staticClass:"line-number"},[t._v("46")]),s("br"),s("span",{staticClass:"line-number"},[t._v("47")]),s("br"),s("span",{staticClass:"line-number"},[t._v("48")]),s("br"),s("span",{staticClass:"line-number"},[t._v("49")]),s("br"),s("span",{staticClass:"line-number"},[t._v("50")]),s("br"),s("span",{staticClass:"line-number"},[t._v("51")]),s("br"),s("span",{staticClass:"line-number"},[t._v("52")]),s("br"),s("span",{staticClass:"line-number"},[t._v("53")]),s("br"),s("span",{staticClass:"line-number"},[t._v("54")]),s("br"),s("span",{staticClass:"line-number"},[t._v("55")]),s("br"),s("span",{staticClass:"line-number"},[t._v("56")]),s("br"),s("span",{staticClass:"line-number"},[t._v("57")]),s("br"),s("span",{staticClass:"line-number"},[t._v("58")]),s("br"),s("span",{staticClass:"line-number"},[t._v("59")]),s("br"),s("span",{staticClass:"line-number"},[t._v("60")]),s("br"),s("span",{staticClass:"line-number"},[t._v("61")]),s("br"),s("span",{staticClass:"line-number"},[t._v("62")]),s("br"),s("span",{staticClass:"line-number"},[t._v("63")]),s("br"),s("span",{staticClass:"line-number"},[t._v("64")]),s("br"),s("span",{staticClass:"line-number"},[t._v("65")]),s("br"),s("span",{staticClass:"line-number"},[t._v("66")]),s("br"),s("span",{staticClass:"line-number"},[t._v("67")]),s("br"),s("span",{staticClass:"line-number"},[t._v("68")]),s("br"),s("span",{staticClass:"line-number"},[t._v("69")]),s("br"),s("span",{staticClass:"line-number"},[t._v("70")]),s("br")])]),s("h3",{attrs:{id:"_2-3-镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-镜像"}},[t._v("#")]),t._v(" 2.3.镜像")]),t._v(" "),s("p",[t._v("前面我们一直在使用别人准备好的镜像，那如果我要部署一个 Java 项目，把它打包为一个镜像该怎么做呢？")]),t._v(" "),s("h4",{attrs:{id:"_2-3-1-镜像结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-镜像结构"}},[t._v("#")]),t._v(" 2.3.1.镜像结构")]),t._v(" "),s("p",[t._v("要想自己构建镜像，必须先了解镜像的结构。")]),t._v(" "),s("p",[t._v("之前我们说过，镜像之所以能让我们快速跨操作系统部署应用而忽略其运行环境、配置，就是因为镜像中包含了程序运行需要的系统函数库、环境、配置、依赖。")]),t._v(" "),s("p",[t._v("因此，自定义镜像本质就是依次准备好程序运行的基础环境、依赖、应用本身、运行配置等文件，并且打包而成。")]),t._v(" "),s("p",[t._v("举个例子，我们要从 0 部署一个 Java 应用，大概流程是这样：")]),t._v(" "),s("ul",[s("li",[t._v("准备一个 linux 服务（CentOS 或者 Ubuntu 均可）")]),t._v(" "),s("li",[t._v("安装并配置 JDK")]),t._v(" "),s("li",[t._v("上传 Jar 包")]),t._v(" "),s("li",[t._v("运行 jar 包")])]),t._v(" "),s("p",[t._v("那因此，我们打包镜像也是分成这么几步：")]),t._v(" "),s("ul",[s("li",[t._v("准备 Linux 运行环境（java 项目并不需要完整的操作系统，"),s("strong",[t._v("仅仅是基础运行环境即可")]),t._v("）")]),t._v(" "),s("li",[t._v("安装并配置 JDK")]),t._v(" "),s("li",[t._v("拷贝 jar 包")]),t._v(" "),s("li",[t._v("配置启动脚本")])]),t._v(" "),s("p",[t._v("上述步骤中的每一次操作其实都是在生产一些文件（系统运行环境、函数库、配置最终都是磁盘文件），所以"),s("strong",[t._v("镜像就是一堆文件的集合")]),t._v("。")]),t._v(" "),s("p",[t._v("但需要注意的是，镜像文件不是随意堆放的，而是按照操作的步骤分层叠加而成，每一层形成的文件都会单独打包并标记一个唯一 id，称为 "),s("strong",[t._v("Layer")]),t._v("（"),s("strong",[t._v("层")]),t._v("）。这样，如果我们构建时用到的某些层其他人已经制作过，就可以直接拷贝使用这些层，而不用重复制作。")]),t._v(" "),s("p",[t._v("例如，第一步中需要的 Linux 运行环境，通用性就很强，所以 Docker 官方就制作了这样的只包含 Linux 运行环境的镜像。我们在制作 java 镜像时，就无需重复制作，直接使用 Docker 官方提供的 CentOS 或 Ubuntu 镜像作为基础镜像。然后再搭建其它层即可，这样逐层搭建，最终整个 Java 项目的镜像结构如图所示：")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cmty256.github.io/picx-images-hosting/microservice/image.7p3diljtzg.webp",loading:"lazy"}})]),t._v(" "),s("h4",{attrs:{id:"_2-3-2-dockerfile"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-dockerfile"}},[t._v("#")]),t._v(" 2.3.2.Dockerfile")]),t._v(" "),s("p",[t._v("由于制作镜像的过程中，需要逐层处理和打包，比较复杂，所以 Docker 就提供了自动打包镜像的功能。我们只需要将打包的过程，每一层要做的事情用固定的语法写下来，交给 Docker 去执行即可。")]),t._v(" "),s("p",[t._v("而这种【记录镜像结构的文件】就称为 "),s("strong",[t._v("Dockerfile")]),t._v("，其对应的语法可以参考官方文档：")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/builder/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.docker.com/engine/reference/builder/"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("其中的语法比较多，比较常用的有：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("指令")])]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("说明")])]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("示例")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("FROM")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("指定基础镜像")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("FROM centos:6")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("ENV")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("设置环境变量，可在后面指令使用")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("ENV key value")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("COPY")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("拷贝本地文件到镜像的指定目录")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("COPY ./xx.jar /tmp/app.jar")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("RUN")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("执行Linux的shell命令，一般是安装过程的命令")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("code",[t._v("RUN yum install gcc")])])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("EXPOSE")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("指定容器运行时监听的端口，是给镜像使用者看的")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("EXPOSE 8080")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("ENTRYPOINT")])]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("镜像中应用的启动命令，容器运行时调用")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("ENTRYPOINT java -jar xx.jar")])])])]),t._v(" "),s("p",[t._v("例如，要基于Ubuntu镜像来构建一个Java应用，其Dockerfile内容如下：")]),t._v(" "),s("div",{staticClass:"language-Dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定基础镜像")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" ubuntu:16.04")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置环境变量，JDK的安装目录、容器内时区")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENV")]),t._v(" JAVA_DIR=/usr/local")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENV")]),t._v(" TZ=Asia/Shanghai")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 拷贝jdk和java项目的包")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" ./jdk8.tar.gz "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$JAVA_DIR")]),t._v("/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" ./docker-demo.jar /tmp/app.jar")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设定时区")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" ln -snf /usr/share/zoneinfo/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$TZ")]),t._v(" /etc/localtime && echo "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$TZ")]),t._v(" > /etc/timezone")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装JDK")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" cd "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$JAVA_DIR")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n && tar -xf ./jdk8.tar.gz "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("\\")]),t._v("\n && mv ./jdk1.8.0_144 ./java8")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置环境变量")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENV")]),t._v(" JAVA_HOME="),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$JAVA_DIR")]),t._v("/java8")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENV")]),t._v(" PATH="),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PATH")]),t._v(":"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$JAVA_HOME")]),t._v("/bin")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定项目监听的端口")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXPOSE")]),t._v(" 8080")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 入口，java项目的启动命令")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENTRYPOINT")]),t._v(" ["),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"java"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-jar"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/app.jar"')]),t._v("]")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br")])]),s("p",[t._v("大家可以思考一下：以后我们会有很多很多 java 项目需要打包为镜像，他们都需要 Linux 系统环境、JDK 环境这两层，只有上面的 3 层不同（因为 jar 包不同）。如果每次制作 java 镜像都重复制作前两层镜像，是不是很麻烦。")]),t._v(" "),s("p",[t._v("所以，就有人提供了基础的系统加 JDK 环境，我们在此基础上制作 java 镜像，就可以省去 JDK 的配置了：")]),t._v(" "),s("div",{staticClass:"language-Dockerfile line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 基础镜像")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" openjdk:11.0-jre-buster")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设定时区")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENV")]),t._v(" TZ=Asia/Shanghai")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" ln -snf /usr/share/zoneinfo/"),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$TZ")]),t._v(" /etc/localtime && echo "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$TZ")]),t._v(" > /etc/timezone")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 拷贝jar包")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" docker-demo.jar /app.jar")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 入口")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token instruction"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENTRYPOINT")]),t._v(" ["),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"java"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-jar"')]),t._v(", "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/app.jar"')]),t._v("]")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])]),s("p",[t._v("是不是简单多了。")]),t._v(" "),s("h4",{attrs:{id:"_2-3-3-构建镜像"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-3-构建镜像"}},[t._v("#")]),t._v(" 2.3.3.构建镜像")]),t._v(" "),s("p",[t._v("当 Dockerfile 文件写好以后，就可以利用命令来构建镜像了。")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("在课前资料中，我们准备好了一个 demo 项目及对应的 Dockerfile")])]),t._v(" "),s("li",[s("p",[t._v("首先，我们将课前资料提供的 "),s("code",[t._v("docker-demo.jar")]),t._v(" 包以及 "),s("code",[t._v("Dockerfile")]),t._v(" 拷贝到虚拟机的 "),s("code",[t._v("/root/demo")]),t._v(" 目录（也可其他目录，但后续指令需对应）")])]),t._v(" "),s("li",[s("p",[t._v("然后，执行命令，构建镜像")])])]),t._v(" "),s("div",{staticClass:"language-Bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入镜像目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /root/demo\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开始构建")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" docker-demo:1.0 "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("命令说明：")]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("docker build")]),t._v(": 就是构建一个 docker 镜像")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("-t docker-demo:1.0")]),t._v(" ："),s("code",[t._v("-t")]),t._v(" 参数是"),s("strong",[t._v("指定镜像的名称")]),t._v("（"),s("code",[t._v("repository")]),t._v("和"),s("code",[t._v("tag")]),t._v("）")])]),t._v(" "),s("li",[s("p",[s("code",[t._v(".")]),t._v(" : 最后的点是指构建时 "),s("strong",[t._v("Dockerfile 所在路径")]),t._v("，由于我们进入了 demo 目录，所以指定的是 "),s("code",[t._v(".")]),t._v(" 代表当前目录，也可以直接指定 Dockerfile 目录：")]),t._v(" "),s("ul",[s("li",[s("div",{staticClass:"language-Bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 直接指定Dockerfile目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" docker-demo:1.0 /root/demo\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])])])])])]),t._v(" "),s("p",[t._v("查看镜像列表：")]),t._v(" "),s("div",{staticClass:"language-Bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看镜像列表：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" images\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\nREPOSITORY    TAG       IMAGE ID       CREATED          SIZE\ndocker-demo   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),t._v("       d6ab0b9e64b9   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("27")]),t._v(" minutes ago   327MB\nnginx         latest    605c77e624dd   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(" months ago    141MB\nmysql         latest    3218b38490ce   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" months ago    516MB\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("p",[t._v("然后尝试运行该镜像：")]),t._v(" "),s("div",{staticClass:"language-Bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.创建并运行容器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v(":8080 docker-demo:1.0\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2.查看容器")]),t._v("\ndps\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\nCONTAINER ID   IMAGE             PORTS                                                  STATUS         NAMES\n78a000447b49   docker-demo:1.0   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:8080-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("/tcp, :::8090-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8090")]),t._v("/tcp              Up "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" seconds   "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v("\nf63cfead8502   mysql             "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:3306-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("/tcp, :::3306-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("/tcp, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("33060")]),t._v("/tcp   Up "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" hours     mysql\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.访问")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" localhost:8080/hello/count\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("h"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("5")]),t._v(">")]),t._v("欢迎访问黑马商城, 这是您第1次访问"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("h"),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("5")]),t._v(">")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br")])]),s("h3",{attrs:{id:"_2-4-网络"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-网络"}},[t._v("#")]),t._v(" 2.4.网络⭐️")]),t._v(" "),s("p",[t._v("上节课我们创建了一个 Java 项目的容器，而 Java 项目往往需要访问其它各种中间件，例如 MySQL、Redis 等。现在，我们的容器之间能否互相访问呢？我们来测试一下")]),t._v(" "),s("p",[t._v("首先，我们查看下 MySQL 容器的详细信息，重点关注其中的网络 IP 地址：")]),t._v(" "),s("div",{staticClass:"language-Bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.用基本命令，寻找Networks.bridge.IPAddress属性")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" inspect mysql\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 也可以使用format过滤结果")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" inspect "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--format")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'{{range .NetworkSettings.Networks}}{{println .IPAddress}}{{end}}'")]),t._v(" mysql\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 得到IP地址如下：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.17")]),t._v(".0.2\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2.然后通过命令进入dd容器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.在容器内，通过ping命令测试网络")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.17")]),t._v(".0.2\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\nPING "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.17")]),t._v(".0.2 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.17")]),t._v(".0.2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("84")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" bytes of data.\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.17")]),t._v(".0.2: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.053")]),t._v(" ms\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.17")]),t._v(".0.2: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.059")]),t._v(" ms\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.17")]),t._v(".0.2: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.058")]),t._v(" ms\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br")])]),s("p",[t._v("发现可以互联，没有问题。")]),t._v(" "),s("p",[t._v("⚠️但是，"),s("strong",[t._v("容器的网络 IP 其实是一个虚拟的 IP，其值并不固定与某一个容器绑定")]),t._v("，如果我们在开发时写死某个 IP，而在部署时很可能 MySQL 容器的 IP 会发生变化，连接会失败。")]),t._v(" "),s("p",[t._v("所以，我们必须借助于 docker 的网络功能来解决这个问题，官方文档：")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://docs.docker.com/engine/reference/commandline/network/"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("常见命令有：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("命令")])]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("说明")])]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("文档地址")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker network create")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("创建一个网络")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_create/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker network create"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker network ls")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("查看所有网络")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_ls/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docs.docker.com"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker network rm")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("删除指定网络")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_rm/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docs.docker.com"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker network prune")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("清除未使用的网络")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_prune/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docs.docker.com"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker network connect")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("使指定容器连接加入某网络")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_connect/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docs.docker.com"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker network disconnect")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("使指定容器连接离开某网络")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_disconnect/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker network disconnect"),s("OutboundLink")],1)])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("docker network inspect")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("查看网络详细信息")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[s("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/network_inspect/",target:"_blank",rel:"noopener noreferrer"}},[t._v("docker network inspect"),s("OutboundLink")],1)])])])]),t._v(" "),s("p",[t._v("教学演示：自定义网络")]),t._v(" "),s("div",{staticClass:"language-Bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.首先通过命令创建一个网络")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" network create hmall\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2.然后查看网络")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" network "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果：")]),t._v("\nNETWORK ID     NAME      DRIVER    SCOPE\n639bc44d0a87   bridge    bridge    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v("\n403f16ec62a2   hmall     bridge    "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v("\n0dc0f72a0fbb   "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v("\ncd8d3e8df47b   none      null      "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("local")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 其中，除了hmall以外，其它都是默认的网络")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.让dd和mysql都加入该网络，注意，在加入网络时可以通过--alias给容器起别名")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 这样该网络内的其它容器可以用别名互相访问！")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.1.mysql容器，指定别名为db，另外每一个容器都有一个别名是容器名")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" network connect hmall mysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--alias")]),t._v(" db\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.2.db容器，也就是我们的java项目")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" network connect hmall "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4.进入dd容器，尝试利用别名访问db")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4.1.进入容器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-it")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4.2.用db别名访问")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" db\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\nPING db "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("84")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" bytes of data.\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from mysql.hmall "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.070")]),t._v(" ms\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from mysql.hmall "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.056")]),t._v(" ms\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4.3.用容器名访问")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ping")]),t._v(" mysql\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果：")]),t._v("\nPING mysql "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("56")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("84")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" bytes of data.\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from mysql.hmall "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.044")]),t._v(" ms\n"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" bytes from mysql.hmall "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),t._v(".0.2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(": "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("icmp_seq")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ttl")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("time")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.054")]),t._v(" ms\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br")])]),s("p",[t._v("OK，现在无需记住 IP 地址也可以实现容器互联了。")]),t._v(" "),s("p",[s("strong",[t._v("总结")]),t._v("：")]),t._v(" "),s("ul",[s("li",[t._v("在自定义网络中，可以给容器起多个别名，默认的别名是容器名本身")]),t._v(" "),s("li",[t._v("在同一个自定义网络中的容器，可以通过别名互相访问")])]),t._v(" "),s("h2",{attrs:{id:"_3-项目部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-项目部署"}},[t._v("#")]),t._v(" 3.项目部署")]),t._v(" "),s("p",[t._v("好了，我们已经熟悉了 Docker 的基本用法，接下来可以尝试部署项目了。")]),t._v(" "),s("p",[t._v("在课前资料中已经提供了一个黑马商城项目给大家，如图：")]),t._v(" "),s("p",[t._v("项目说明：")]),t._v(" "),s("ul",[s("li",[t._v("hmall：商城的后端代码")]),t._v(" "),s("li",[t._v("hmall-portal：商城用户端的前端代码")]),t._v(" "),s("li",[t._v("hmall-admin：商城管理端的前端代码")])]),t._v(" "),s("p",[t._v("部署的容器及端口说明：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("项目")])]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("容器名")])]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("端口")])]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("备注")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("hmall")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("hmall")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("8080")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("黑马商城后端API入口")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("hmall-portal")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("nginx")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("18080")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("黑马商城用户端入口")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("hmall-admin")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("18081")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("黑马商城管理端入口")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("mysql")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("mysql")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("3306")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("数据库")])])])]),t._v(" "),s("p",[t._v("在正式部署前，我们先删除之前的nginx、dd两个容器：")]),t._v(" "),s("div",{staticClass:"language-Bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" nginx "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("dd")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("mysql容器中已经准备好了商城的数据，所以就不再删除了。")]),t._v(" "),s("h3",{attrs:{id:"_3-1-部署-java-项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-部署-java-项目"}},[t._v("#")]),t._v(" 3.1.部署 Java 项目")]),t._v(" "),s("p",[s("code",[t._v("hmall")]),t._v("项目是一个maven聚合项目，使用IDEA打开"),s("code",[t._v("hmall")]),t._v("项目，查看项目结构如图：")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://dvh0be7f2bt.feishu.cn/space/api/box/stream/download/asynccode/?code=YWNkZTM1ZTYxMTE2NGQ1NzFiM2Y0ZTZhZjJkNzhkYTdfQ1JFUG5xRERRbHRHcHRuRE01VlFMbllkckM2bnF3VExfVG9rZW46R241ZWJPSGhOb2RUdXZ4N2xiU2MzMDE3bmdmXzE3MTE4Nzc1NzI6MTcxMTg4MTE3Ml9WNA",loading:"lazy"}})]),t._v(" "),s("p",[t._v("我们要部署的就是其中的"),s("code",[t._v("hm-service")]),t._v("，其中的配置文件采用了多环境的方式：")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://dvh0be7f2bt.feishu.cn/space/api/box/stream/download/asynccode/?code=MGNlNmUyM2YwYzFhMTdjYzliMTI1OGFkNGYzZDVjYmFfZU1vMUxNaExKN2l4RDhIb0NVcnlReGFqVmhmMlNNY1FfVG9rZW46VFU4NWJWU2lSb2VoM094anhNS2N2WkhHbkVmXzE3MTE4Nzc1NzI6MTcxMTg4MTE3Ml9WNA",loading:"lazy"}})]),t._v(" "),s("p",[t._v("其中的"),s("code",[t._v("application-dev.yaml")]),t._v("是部署到开发环境的配置，"),s("code",[t._v("application-local.yaml")]),t._v("是本地运行时的配置。")]),t._v(" "),s("p",[t._v("查看application.yaml，你会发现其中的JDBC地址并未写死，而是读取变量：")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://dvh0be7f2bt.feishu.cn/space/api/box/stream/download/asynccode/?code=ZTQ4NDQ5ZDU5MmQ1ZmRmMDhmZjdjZjBhOTk0NmYzOTJfMlQwT2xXajN4RDE1Q3pNN1JWNUhFdWZJZkp0b1phNlNfVG9rZW46UTE0MmJicmZ5b2p0VHZ4VDRMMmNqMG03bkJkXzE3MTE4Nzc1NzI6MTcxMTg4MTE3Ml9WNA",loading:"lazy"}})]),t._v(" "),s("p",[t._v("这两个变量在"),s("code",[t._v("application-dev.yaml")]),t._v("和"),s("code",[t._v("application-local.yaml")]),t._v("中并不相同：")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://dvh0be7f2bt.feishu.cn/space/api/box/stream/download/asynccode/?code=NzVhZTBkOWQwODk5NTg5ZjE0YTRkZjQ4NWZjOGUwN2FfOGFWMzFNVk5MQUlYRDA4WnRFOEhQNDNHNVdLQ3c0M0pfVG9rZW46THFZWWJ5cEFyb3FhVlp4TVI3bmNKa3h3blBkXzE3MTE4Nzc1NzI6MTcxMTg4MTE3Ml9WNA",loading:"lazy"}})]),t._v(" "),s("p",[t._v("在dev开发环境（也就是Docker部署时）采用了mysql作为地址，刚好是我们的mysql容器名，只要两者在一个网络，就一定能互相访问。")]),t._v(" "),s("p",[t._v("我们将项目打包：")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://dvh0be7f2bt.feishu.cn/space/api/box/stream/download/asynccode/?code=NjUxZGE4NThlOGFhN2VkZjc5YTc2OGNkN2I3YzE0NjJfMHZMTTZoeXVQU25OelViU1NaSktmSWdqRmk4MzRiNjNfVG9rZW46QnRabmJqcUZWb1U2NFl4bGRQYWMxSFc5bmpiXzE3MTE4Nzc1NzI6MTcxMTg4MTE3Ml9WNA",loading:"lazy"}})]),t._v(" "),s("p",[t._v("结果：")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://dvh0be7f2bt.feishu.cn/space/api/box/stream/download/asynccode/?code=OTIxMzI5ZWQxZWFhOWUxNjJlOTQzOTJlM2JlMDBlZGVfdFNjVGlEb3BKMWxtT2VEejhsWVh3Nm13M1hmajZ5UzNfVG9rZW46TWoxV2JBcW1Tb045eFZ4UW9TS2NaSE1tbkx3XzE3MTE4Nzc1NzI6MTcxMTg4MTE3Ml9WNA",loading:"lazy"}})]),t._v(" "),s("p",[t._v("将"),s("code",[t._v("hm-service")]),t._v("目录下的"),s("code",[t._v("Dockerfile")]),t._v("和"),s("code",[t._v("hm-service/target")]),t._v("目录下的"),s("code",[t._v("hm-service.jar")]),t._v("一起上传到虚拟机的"),s("code",[t._v("root")]),t._v("目录：")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://dvh0be7f2bt.feishu.cn/space/api/box/stream/download/asynccode/?code=M2UyMzMwZTA5Y2Y0ZmU3YTNjNjVhYzk1ZTU5NmEwMTlfanNQRGlOTU8xUGxaQ204ekZLVDdkRXhGcEthbVV3Z2NfVG9rZW46SWgxVmJ1eWxQb1dNSXF4TjNsZGNQdE1MbmtiXzE3MTE4Nzc1NzI6MTcxMTg4MTE3Ml9WNA",loading:"lazy"}})]),t._v(" "),s("p",[t._v("部署项目：")]),t._v(" "),s("div",{staticClass:"language-Bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.构建项目镜像，不指定tag，则默认为latest")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" build "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" hmall "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2.查看镜像")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" images\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\nREPOSITORY    TAG       IMAGE ID       CREATED          SIZE\nhmall         latest    0bb07b2c34b9   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("43")]),t._v(" seconds ago   362MB\ndocker-demo   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0")]),t._v("       49743484da68   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" hours ago     327MB\nnginx         latest    605c77e624dd   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v(" months ago    141MB\nmysql         latest    3218b38490ce   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),t._v(" months ago    516MB\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.创建并运行容器，并通过--network将其加入hmall网络，这样才能通过容器名访问mysql")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" hmall "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--network")]),t._v(" hmall "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v(":8080 hmall\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br")])]),s("p",[t._v("测试，通过浏览器访问：http://你的虚拟机地址:8080/search/list")]),t._v(" "),s("h3",{attrs:{id:"_3-2-部署前端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-部署前端"}},[t._v("#")]),t._v(" 3.2.部署前端")]),t._v(" "),s("p",[s("code",[t._v("hmall-portal")]),t._v("和"),s("code",[t._v("hmall-admin")]),t._v("是前端代码，需要基于nginx部署。在课前资料中已经给大家提供了nginx的部署目录：")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://dvh0be7f2bt.feishu.cn/space/api/box/stream/download/asynccode/?code=YWQzMjlmYWMxYmRjZGE0ZmVhOTdkZmE5YmMwZjM0ZThfQm1OV3g5R3FFNjRXcXhrbTJVYTJsZ1pNZnFNYXBLcGJfVG9rZW46VlBkS2J3RGh2bzVtSTR4aVdHY2NpN25LbndkXzE3MTE4Nzc1NzI6MTcxMTg4MTE3Ml9WNA",loading:"lazy"}})]),t._v(" "),s("p",[t._v("其中：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("html")]),t._v("是静态资源目录，我们需要把"),s("code",[t._v("hmall-portal")]),t._v("以及"),s("code",[t._v("hmall-admin")]),t._v("都复制进去")]),t._v(" "),s("li",[s("code",[t._v("nginx.conf")]),t._v("是nginx的配置文件，主要是完成对"),s("code",[t._v("html")]),t._v("下的两个静态资源目录做代理")])]),t._v(" "),s("p",[t._v("我们现在要做的就是把整个nginx目录上传到虚拟机的"),s("code",[t._v("/root")]),t._v("目录下：")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://dvh0be7f2bt.feishu.cn/space/api/box/stream/download/asynccode/?code=Nzc2MjAyZmY3MjAwZGNiYzRhZDg4YjY2Mjg1MzY2OWJfeXdxclB1Q1ZrMWJXaGlwQzNPT0w3YVVKdEF5SmxPaDlfVG9rZW46VzFrcWJMZEl5bzViUkN4cHg1c2NkVTcwbldoXzE3MTE4Nzc1NzI6MTcxMTg4MTE3Ml9WNA",loading:"lazy"}})]),t._v(" "),s("p",[t._v("然后创建nginx容器并完成两个挂载：")]),t._v(" "),s("ul",[s("li",[t._v("把"),s("code",[t._v("/root/nginx/nginx.conf")]),t._v("挂载到"),s("code",[t._v("/etc/nginx/nginx.conf")])]),t._v(" "),s("li",[t._v("把"),s("code",[t._v("/root/nginx/html")]),t._v("挂载到"),s("code",[t._v("/usr/share/nginx/html")])])]),t._v(" "),s("p",[t._v("由于需要让nginx同时代理hmall-portal和hmall-admin两套前端资源，因此我们需要暴露两个端口：")]),t._v(" "),s("ul",[s("li",[t._v("18080：对应hmall-portal")]),t._v(" "),s("li",[t._v("18081：对应hmall-admin")])]),t._v(" "),s("p",[t._v("命令如下：")]),t._v(" "),s("div",{staticClass:"language-Bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" nginx "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18080")]),t._v(":18080 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18081")]),t._v(":18081 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" /root/nginx/html:/usr/share/nginx/html "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" /root/nginx/nginx.conf:/etc/nginx/nginx.conf "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--network")]),t._v(" hmall "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  nginx\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[t._v("测试，通过浏览器访问：http://你的虚拟机ip:18080")]),t._v(" "),s("p",[s("img",{staticClass:"lazy",attrs:{alt:"img","data-src":"https://dvh0be7f2bt.feishu.cn/space/api/box/stream/download/asynccode/?code=MjJmYjdkYjYxNThmNWQ0ZTFjZGFiMDQwMzg3NjBhNTNfNk9naDUzb1hJblc3SDVZSEpLc0dGV3VhWFpNeEp6RzhfVG9rZW46TmVoT2JoRG1hb2pMa1h4VGFoa2NTSkNwbjFjXzE3MTE4Nzc1NzI6MTcxMTg4MTE3Ml9WNA",loading:"lazy"}})]),t._v(" "),s("h3",{attrs:{id:"_3-3-dockercompose"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-dockercompose"}},[t._v("#")]),t._v(" 3.3.DockerCompose")]),t._v(" "),s("p",[t._v("大家可以看到，我们部署一个简单的java项目，其中包含3个容器：")]),t._v(" "),s("ul",[s("li",[t._v("MySQL")]),t._v(" "),s("li",[t._v("Nginx")]),t._v(" "),s("li",[t._v("Java项目")])]),t._v(" "),s("p",[t._v("而稍微复杂的项目，其中还会有各种各样的其它中间件，需要部署的东西远不止3个。如果还像之前那样手动的逐一部署，就太麻烦了。")]),t._v(" "),s("p",[t._v("而Docker Compose就可以帮助我们实现"),s("strong",[t._v("多个相互关联的Docker容器的快速部署")]),t._v("。它允许用户通过一个单独的 docker-compose.yml 模板文件（YAML 格式）来定义一组相关联的应用容器。")]),t._v(" "),s("h4",{attrs:{id:"_3-3-1-基本语法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-1-基本语法"}},[t._v("#")]),t._v(" 3.3.1.基本语法")]),t._v(" "),s("p",[t._v("docker-compose.yml文件的基本语法可以参考官方文档：")]),t._v(" "),s("p",[t._v("https://docs.docker.com/compose/compose-file/compose-file-v3/")]),t._v(" "),s("p",[t._v("docker-compose文件中可以定义多个相互关联的应用容器，每一个应用容器被称为一个服务（service）。由于service就是在定义某个应用的运行时参数，因此与"),s("code",[t._v("docker run")]),t._v("参数非常相似。")]),t._v(" "),s("p",[t._v("举例来说，用docker run部署MySQL的命令如下：")]),t._v(" "),s("div",{staticClass:"language-Bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" run "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" mysql "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-p")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v(":3306 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("TZ")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Asia/Shanghai "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("123")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" ./mysql/data:/var/lib/mysql "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" ./mysql/conf:/etc/mysql/conf.d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" ./mysql/init:/docker-entrypoint-initdb.d "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--network")]),t._v(" hmall\n  mysql\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("p",[t._v("如果用"),s("code",[t._v("docker-compose.yml")]),t._v("文件来定义，就是这样：")]),t._v(" "),s("div",{staticClass:"language-YAML line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.8"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mysql")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3306:3306"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TZ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Asia/Shanghai\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("123")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./mysql/conf:/etc/mysql/conf.d"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./mysql/data:/var/lib/mysql"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" new\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("new")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hmall\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br")])]),s("p",[t._v("对比如下：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("docker run 参数")])]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("docker compose 指令")])]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("说明")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("--name")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("container_name")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("容器名称")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("-p")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("ports")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("端口映射")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("-e")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("environment")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("环境变量")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("-v")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("volumes")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("数据卷配置")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("--network")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("networks")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("网络")])])])]),t._v(" "),s("p",[t._v("明白了其中的对应关系，相信编写"),s("code",[t._v("docker-compose")]),t._v("文件应该难不倒大家。")]),t._v(" "),s("p",[t._v("黑马商城部署文件：")]),t._v(" "),s("div",{staticClass:"language-YAML line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.8"')]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mysql")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3306:3306"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TZ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Asia/Shanghai\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("123")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./mysql/conf:/etc/mysql/conf.d"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./mysql/data:/var/lib/mysql"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./mysql/init:/docker-entrypoint-initdb.d"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" hm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("net\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hmall")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" \n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("context")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dockerfile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Dockerfile\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hmall\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8080:8080"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" hm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("net\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" mysql\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nginx")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"18080:18080"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"18081:18081"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./nginx/nginx.conf:/etc/nginx/nginx.conf"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./nginx/html:/usr/share/nginx/html"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" hmall\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" hm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("net\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hm-net")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" hmall\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br")])]),s("h4",{attrs:{id:"_3-3-2-基础命令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-基础命令"}},[t._v("#")]),t._v(" 3.3.2.基础命令")]),t._v(" "),s("p",[t._v("编写好docker-compose.yml文件，就可以部署项目了。常见的命令：")]),t._v(" "),s("p",[t._v("https://docs.docker.com/compose/reference/")]),t._v(" "),s("p",[t._v("基本语法如下：")]),t._v(" "),s("div",{staticClass:"language-Bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" compose "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("OPTIONS"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("COMMAND"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("其中，OPTIONS和COMMAND都是可选参数，比较常见的有：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("类型")])]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("参数或指令")])]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[s("strong",[t._v("说明")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("Options")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("-f")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("指定compose文件的路径和名称（在本地时可不指定）")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("-p")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("指定project名称。project就是当前compose文件中设置的多个service的集合，是逻辑概念")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("Commands")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("up")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("创建并启动所有service容器")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("down")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("停止并移除所有容器、网络")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("ps")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("列出所有启动的容器")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("logs")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("查看指定容器的日志")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("stop")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("停止容器")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("start")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("启动容器")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("restart")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("重启容器")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("top")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("查看运行的进程")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("exec")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("在指定的运行中容器中执行命令")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}})])])]),t._v(" "),s("p",[t._v("教学演示：")]),t._v(" "),s("div",{staticClass:"language-Bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 1.进入root目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /root\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 2.删除旧容器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-qa")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 3.删除hmall镜像")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" rmi hmall\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 4.清空MySQL数据")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-rf")]),t._v(" mysql/data\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 5.启动所有, -d 参数是后台启动")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" compose up "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Building "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(".5s "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("/8"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" FINISHED\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("internal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" load build definition from Dockerfile                                    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" transferring dockerfile: 358B                                                    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("internal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" load .dockerignore                                                       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" transferring context: 2B                                                         "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("internal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" load metadata "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" docker.io/library/openjdk:11.0-jre-buster             "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),t._v(".4s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" FROM docker.io/library/openjdk:11.0-jre-buster@sha256:3546a17e6fb4ff4fa681c3  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("internal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" load build context                                                       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" transferring context: 98B                                                        "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" CACHED "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("/3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" RUN "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-snf")]),t._v(" /usr/share/zoneinfo/Asia/Shanghai /etc/localtime "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" CACHED "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("/3"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" COPY hm-service.jar /app.jar                                           "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" exporting to image                                                                  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" exporting layers                                                                 "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" writing image sha256:32eebee16acde22550232f2eb80c69d2ce813ed099640e4cfed2193f71  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" naming to docker.io/library/root-hmall                                           "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".0s\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Running "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("/4\n ✔ Network hmall    Created                                                             "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".2s\n ✔ Container mysql  Started                                                             "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".5s\n ✔ Container hmall  Started                                                             "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(".9s\n ✔ Container nginx  Started                                                             "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(".5s\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 6.查看镜像")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" compose images\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\nCONTAINER           REPOSITORY          TAG                 IMAGE ID            SIZE\nhmall               root-hmall          latest              32eebee16acd        362MB\nmysql               mysql               latest              3218b38490ce        516MB\nnginx               nginx               latest              605c77e624dd        141MB\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 7.查看容器")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("docker")]),t._v(" compose "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 结果")]),t._v("\nNAME                IMAGE               COMMAND                  SERVICE             CREATED             STATUS              PORTS\nhmall               root-hmall          "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"java -jar /app.jar"')]),t._v("     hmall               "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("54")]),t._v(" seconds ago      Up "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("52")]),t._v(" seconds       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:8080-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("/tcp, :::8080-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("/tcp\nmysql               mysql               "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker-entrypoint.s…"')]),t._v("   mysql               "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("54")]),t._v(" seconds ago      Up "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("53")]),t._v(" seconds       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:3306-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("/tcp, :::3306-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("/tcp, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("33060")]),t._v("/tcp\nnginx               nginx               "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/docker-entrypoint.…"')]),t._v("   nginx               "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("54")]),t._v(" seconds ago      Up "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("52")]),t._v(" seconds       "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/tcp, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:18080-18081-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18080")]),t._v("-18081/tcp, :::18080-18081-"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18080")]),t._v("-18081/tcp\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br"),s("span",{staticClass:"line-number"},[t._v("46")]),s("br"),s("span",{staticClass:"line-number"},[t._v("47")]),s("br"),s("span",{staticClass:"line-number"},[t._v("48")]),s("br"),s("span",{staticClass:"line-number"},[t._v("49")]),s("br"),s("span",{staticClass:"line-number"},[t._v("50")]),s("br"),s("span",{staticClass:"line-number"},[t._v("51")]),s("br")])]),s("p",[t._v("打开浏览器，访问：http://yourIp:8080")])])}),[],!1,null,null,null);s.default=n.exports}}]);