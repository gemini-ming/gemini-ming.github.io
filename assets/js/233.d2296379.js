(window.webpackJsonp=window.webpackJsonp||[]).push([[233],{565:function(s,a,t){"use strict";t.r(a);var n=t(1),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"项目部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目部署"}},[s._v("#")]),s._v(" 项目部署")]),s._v(" "),a("h2",{attrs:{id:"多环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多环境"}},[s._v("#")]),s._v(" 多环境")]),s._v(" "),a("blockquote",[a("p",[s._v("在项目部署前，先了解一下什么是多环境。")])]),s._v(" "),a("p",[s._v("参考文章：https://blog.csdn.net/weixin_41701290/article/details/120173283")]),s._v(" "),a("p",[s._v("本地开发：localhost（127.0.0.1）")]),s._v(" "),a("p",[s._v("多环境：指同一套项目代码在不同的阶段需要根据实际情况来调整配置并且部署到不同的机器上。")]),s._v(" "),a("p",[s._v("为什么需要？")]),s._v(" "),a("ol",[a("li",[s._v("每个环境互不影响")]),s._v(" "),a("li",[s._v("区分不同的阶段：开发 / 测试 / 生产")]),s._v(" "),a("li",[s._v("对项目进行优化：\n"),a("ol",[a("li",[s._v("本地日志级别（比如在开发阶段可以在控制台打很多日志来调试，但上线的时候就不可以了，给用户看到这些日志会有风险）")]),s._v(" "),a("li",[s._v("精简依赖，节省项目体积")]),s._v(" "),a("li",[s._v("项目的环境 / 参数可以调整，比如 JVM 参数")])])])]),s._v(" "),a("p",[s._v("针对不同环境做不同的事情。（可以联想一下 maven 依赖的不同作用域）")]),s._v(" "),a("p",[s._v("多环境分类：")]),s._v(" "),a("ol",[a("li",[s._v("本地环境（自己的电脑）localhost")]),s._v(" "),a("li",[s._v("开发环境（远程开发）大家连同一台机器，为了大家开发方便")]),s._v(" "),a("li",[s._v("测试环境（测试）开发 / 测试 / 产品，单元测试 / 性能测试 / 功能测试 / 系统集成测试，独立的数据库、独立的服务器（测试是测试 bug，产品是体验一下是否符合要求）")]),s._v(" "),a("li",[s._v("预发布环境（体验服）：和正式环境一致，正式数据库，更严谨，查出更多问题")]),s._v(" "),a("li",[s._v("正式环境（线上，公开对外访问的项目）：尽量不要改动，保证上线前的代码是 “完美” 运行")]),s._v(" "),a("li",[s._v("沙箱环境（实验环境）：为了做实验，可以看成是测试环境的一种，单独出来的环境")])]),s._v(" "),a("h3",{attrs:{id:"前端多环境实战"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端多环境实战"}},[s._v("#")]),s._v(" 前端多环境实战")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("请求地址")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("开发环境：localhost:8000")])]),s._v(" "),a("li",[a("p",[s._v("线上环境：服务器 IP")])])]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("startFront")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("env "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'prod'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 不输出注释 ")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 项目优化")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 修改请求地址")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 保持本地开发逻辑")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("这里用了 umi 框架，build 时会自动传入 "),a("code",[s._v("NODE_ENV == production")]),s._v(" 参数，"),a("code",[s._v("start NODE_ENV")]),s._v(" 参数为 "),a("code",[s._v("development")])]),s._v(" "),a("p",[a("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cmty256.github.io/imgs-blog/images/image.7chaeg3luu40.webp",loading:"lazy"}})])]),s._v(" "),a("li",[a("p",[s._v("启动方式")]),s._v(" "),a("ul",[a("li",[s._v("开发环境：npm run start（本地启动，监听端口、自动更新）")]),s._v(" "),a("li",[s._v("线上环境：npm run build（项目构建打包），可以使用 serve 工具启动（npm i -g serve 安装）")])])]),s._v(" "),a("li",[a("p",[s._v("项目的配置（这里以 Ant design Pro 脚手架搭建的项目为例）")]),s._v(" "),a("p",[s._v("不同的项目（框架）都有不同的配置文件，umi 的配置文件是 config，可以在配置文件后添加对应的环境名称后缀来区分开发环境和生产环境。")]),s._v(" "),a("p",[s._v("部署前建议先看一下框架关于部署方面的官方文档，umi 部署参考文档：https://umijs.org/zh-CN/docs/deployment")]),s._v(" "),a("ul",[a("li",[s._v("开发环境：config.dev.ts")]),s._v(" "),a("li",[s._v("生产环境：config.prod.ts")]),s._v(" "),a("li",[s._v("公共配置：config.ts 不带后缀")])])])]),s._v(" "),a("h4",{attrs:{id:"静态化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#静态化"}},[s._v("#")]),s._v(" 静态化")]),s._v(" "),a("p",[s._v("在有 "),a("code",[s._v("exportStatic: {}")]),s._v(" 的时候根据路由生成的目录下面都是有 index.html")]),s._v(" "),a("h4",{attrs:{id:"操作示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作示例"}},[s._v("#")]),s._v(" 操作示例")]),s._v(" "),a("p",[s._v("在 globalRequest.ts 下修改 prefix")]),s._v(" "),a("div",{staticClass:"language-ts line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" request "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("extend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n  credentials"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'include'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 默认请求是否带上cookie  ")]),s._v("\n  prefix"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE_ENV")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'production'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://user-backend.code-nav.cn'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),s._v("  \n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// requestType: 'form',  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("修改前：")]),s._v(" "),a("p",[s._v("请求网址: http://localhost:8000/api/user/login")]),s._v(" "),a("p",[s._v("修改后：")]),s._v(" "),a("p",[s._v("请求网址: http://user-backend.code-nav.cn/api/user/login")]),s._v(" "),a("h3",{attrs:{id:"后端多环境实战"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#后端多环境实战"}},[s._v("#")]),s._v(" 后端多环境实战")]),s._v(" "),a("p",[s._v("SpringBoot 项目，通过 application.yml 添加不同的后缀来区分配置文件")]),s._v(" "),a("ul",[a("li",[s._v("package 打包项目 jar 包")]),s._v(" "),a("li",[s._v("运行 jar 包来启动项目")])]),s._v(" "),a("p",[s._v("可以在启动项目时传入环境变量（这是 windows 下执行的命令）：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-jar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("jar 包名称"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--spring.profiles.active")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("prod\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("主要是改：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("依赖的环境地址")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("数据库地址")])]),s._v(" "),a("li",[a("p",[s._v("缓存地址")])]),s._v(" "),a("li",[a("p",[s._v("消息队列地址")])]),s._v(" "),a("li",[a("p",[s._v("项目端口号")])])])]),s._v(" "),a("li",[a("p",[s._v("服务器配置")])])]),s._v(" "),a("h2",{attrs:{id:"项目部署-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目部署-2"}},[s._v("#")]),s._v(" 项目部署")]),s._v(" "),a("p",[s._v("参考文章：https://www.bilibili.com/read/cv16179200")]),s._v(" "),a("p",[s._v("需要 Linux 服务器（建议大家用 CentOS 8+ / 7.6 以上）")]),s._v(" "),a("h3",{attrs:{id:"原始部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原始部署"}},[s._v("#")]),s._v(" 原始部署")]),s._v(" "),a("p",[s._v("什么都自己装")]),s._v(" "),a("h4",{attrs:{id:"前端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端"}},[s._v("#")]),s._v(" 前端")]),s._v(" "),a("p",[s._v("需要 web 服务器："),a("strong",[s._v("nginx")]),s._v(" 、apache、tomcat")]),s._v(" "),a("p",[s._v("安装 nginx 服务器：")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("用系统自带的软件包管理器快速安装，比如 centos 的 yum")])]),s._v(" "),a("li",[a("p",[s._v("自己到官网安装，下载稳定版的")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("//创建文件夹services并进入\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" services\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" services\n\n//使用命令下载稳定版nginx1.20.2：\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" nginx-1.20.2.tar.gz https://nginx.org/download/nginx-1.20.2.tar.gz\n\n//解压\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-xzvf")]),s._v(" nginx-1.20.2.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" nginx-1.20.2\n\n//yum安装pcre\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" pcre pcre-devel "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n\n//yum安装openssl\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" openssl openssl-devel "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v("\n\n//设置系统配置参数\n./configure --with-http_ssl_module --with-http_v2_module --with-stream\n\n//编译并安装\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n\n//添加环境变量\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/profile\n最后一行新增：\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),s._v(":/usr/local/nginx/sbin\n生效：\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile\n\n\n//加入system管理\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /usr/lib/systemd/system/nginx.service\n\n输入：\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx - high performance web server\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Documentation")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://nginx.org/en/docs/\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network-online.target remote-fs.target nss-lookup.target\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Wants")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network-online.target\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forking\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PIDFile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx/logs/nginx.pid\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx/sbin/nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" /usr/local/nginx/conf/nginx.conf\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecReload")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx/sbin/nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" reload\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStop")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/nginx/sbin/nginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" stop\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n\n重载并启动：\ndaemon-reload\nsystemctl start nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br")])]),a("p",[s._v("注意 nginx 权限（需要将 "),a("code",[s._v("nobody")]),s._v(" 改写为 "),a("code",[s._v("root")]),s._v(" 用户）")])])]),s._v(" "),a("p",[s._v("部署前端项目：\n在 idea 中执行 build，把 dist 文件夹添加到 services 文件夹中并改名为 user-center-front\n在 /usr/local/nginx/conf 目录下（真正应用配置的目录）修改配置文件 nginx.conf")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("将 location 中的 root 目录改成项目文件的目录：\n"),a("img",{staticClass:"lazy",attrs:{alt:"image","data-src":"https://cmty256.github.io/imgs-blog/project/image.2yqdl7v0f6u0.webp",loading:"lazy"}})])]),s._v(" "),a("li",[a("p",[s._v("在顶部修改 user 为 root（403 Forbidden 解决方法)")])]),s._v(" "),a("li",[a("p",[a("code",[s._v("nginx -s reload")]),s._v(" 重载 nginx")])]),s._v(" "),a("li",[a("p",[s._v("访问 云服务器 ip:80 即可")])])]),s._v(" "),a("h4",{attrs:{id:"后端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#后端"}},[s._v("#")]),s._v(" 后端")]),s._v(" "),a("p",[s._v("java、maven")]),s._v(" "),a("p",[s._v("安装：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -y 是指不询问")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装jdk1.8")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" java-1.8.0-openjdk*\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在services目录下下载maven")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" apache-maven-3.8.8-bin.tar.gz\n\n在/etc/profile最后加上maven文件夹的bin目录\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打包，跳过测试")]),s._v("\nmvn package "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-DskipTests")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后台启动jar包，nohup")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("java")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-jar")]),s._v(" /root/services/user-center-backend/target/user-center-0.0.1-SNAPSHOT.jar "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--spring.profiles.active")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("prod "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"宝塔-linux-部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#宝塔-linux-部署"}},[s._v("#")]),s._v(" 宝塔 Linux 部署")]),s._v(" "),a("p",[s._v("Linux 运维面板")]),s._v(" "),a("p",[s._v("官方安装教程：https://www.bt.cn/new/download.html")]),s._v(" "),a("p",[s._v("方便管理服务器、方便安装软件")]),s._v(" "),a("p",[s._v("查看面板账户信息")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" /etc/init.d/bt default\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("这条命令会输出【外网、内网】地址")])]),s._v(" "),a("p",[s._v("宝塔装的软件在 "),a("code",[s._v("/www/server")]),s._v(" 目录下")]),s._v(" "),a("ol",[a("li",[s._v("进入宝塔后，点击【面板设置】，修改用户名和密码")]),s._v(" "),a("li",[s._v("点击【软件商店】，下载软件（编译安装可能会慢一些，笔者这里选了快速安装）\n"),a("ul",[a("li",[s._v("nginx 1.20")]),s._v(" "),a("li",[s._v("java 项目一键部署 3.4（只是个插件）")]),s._v(" "),a("li",[s._v("tomcat 9（只是为了安装个 java 环境，装了之后卸载不影响）")])])]),s._v(" "),a("li",[s._v("点击【网站】，添加站点 -> 只输入域名就行")]),s._v(" "),a("li",[s._v("点击 根目录 下面的地址，删除所有文件。然后将 前端打包好的 dist 目录里面的文件全部上传到该目录")]),s._v(" "),a("li",[s._v("然后将 原本的访问路径 中的 localhost 替换成 服务器IP 即可渲染出前端页面")])]),s._v(" "),a("p",[s._v("宝塔部署后端：")]),s._v(" "),a("p",[s._v("左边点击【文件】，新建目录，用来部署后端项目")]),s._v(" "),a("p",[s._v("然后上传后端项目 jar 包到该目录下")]),s._v(" "),a("p",[s._v("参考博客："),a("a",{attrs:{href:"https://blog.csdn.net/qq_48922459/article/details/121842546",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/qq_48922459/article/details/121842546"),a("OutboundLink")],1)]),s._v(" "),a("h3",{attrs:{id:"前端托管"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端托管"}},[s._v("#")]),s._v(" 前端托管")]),s._v(" "),a("p",[s._v("前端腾讯云 web 应用托管（比容器化更傻瓜式，不需要自己写构建应用的命令，就能启动前端项目）")]),s._v(" "),a("blockquote",[a("p",[s._v("https://console.cloud.tencent.com/webify/new")])]),s._v(" "),a("ul",[a("li",[s._v("小缺点：需要将代码放到代码托管平台上")]),s._v(" "),a("li",[s._v("优势：不用写命令、代码更新时自动构建")])]),s._v(" "),a("h3",{attrs:{id:"docker-部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-部署"}},[s._v("#")]),s._v(" Docker 部署")]),s._v(" "),a("p",[a("em",[s._v("后端：Dockefile 文件")])]),s._v(" "),a("p",[s._v("需提前配置好 "),a("code",[s._v("application-prod.yml")])]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("FROM")]),s._v(" maven"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.5")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("jdk"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("alpine as builder\n\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Copy")]),s._v(" local code "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("the")]),s._v(" container image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("WORKDIR")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("app\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COPY")]),s._v(" pom"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xml "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("COPY")]),s._v(" src "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("/src\n\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Build")]),s._v(" a release artifact"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("RUN")]),s._v(" mvn "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("DskipTests")]),s._v("\n\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Run")]),s._v(" the web service on container startup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("CMD")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/app/target/easy-web-0.0.1-SNAPSHOT.jar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--spring.profiles.active=prod"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[a("em",[s._v("前端：/docker/nginx.conf")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('server {\n    listen 80;\n\n    # gzip config\n    gzip on;\n    gzip_min_length 1k;\n    gzip_comp_level 9;\n    gzip_types text/plain text/css text/javascript application/json application/javascript application/x-javascript application/xml;\n    gzip_vary on;\n    gzip_disable "MSIE [1-6]\\.";\n\n    root /usr/share/nginx/html;\n    include /etc/nginx/mime.types;\n\n    location / {\n        try_files $uri /index.html;\n    }\n\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[a("em",[s._v("Dockerfile 文件")])]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('FROM nginx\n\nWORKDIR /usr/share/nginx/html/\nUSER root\n\nCOPY ./docker/nginx.conf /etc/nginx/conf.d/default.conf\n\nCOPY ./dist  /usr/share/nginx/html/\n\nEXPOSE 80\n\nCMD ["nginx", "-g", "daemon off;"]\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("docker 是容器，可以将项目的环境（比如 java、nginx）和项目的代码一起打包成镜像，所有同学都能下载镜像，更容易分发和移植。")]),s._v(" "),a("p",[s._v("再启动项目时，不需要敲一大堆命令，而是直接下载镜像、启动镜像就可以了。")]),s._v(" "),a("p",[s._v("docker 可以理解为软件安装包。")]),s._v(" "),a("p",[s._v("Docker 安装：https://www.docker.com/get-started/ 或者宝塔安装")]),s._v(" "),a("p",[s._v("Dockerfile 用于指定构建 Docker 镜像的方法")]),s._v(" "),a("p",[s._v("Dockerfile 一般情况下不需要完全从 0 自己写，建议去 github、gitee 等托管平台参考同类项目（比如 springboot）")]),s._v(" "),a("p",[s._v("Dockerfile 编写：")]),s._v(" "),a("ul",[a("li",[s._v("FROM 依赖的基础镜像")]),s._v(" "),a("li",[s._v("WORKDIR 工作目录")]),s._v(" "),a("li",[s._v("COPY 从本机复制文件")]),s._v(" "),a("li",[s._v("RUN 执行命令")]),s._v(" "),a("li",[s._v("CMD / ENTRYPOINT（附加额外参数）指定运行容器时默认执行的命令")])]),s._v(" "),a("p",[s._v("根据 Dockerfile 构建镜像：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后端")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" user-center-backend:v0.0.1 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 前端")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" build "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" user-center-front:v0.0.1 "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("Docker 构建优化：减少尺寸、减少构建时间（比如多阶段构建，可以丢弃之前阶段不需要的内容）")]),s._v(" "),a("p",[s._v("docker run 启动：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 前端")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" user-center-frontend:v0.0.1\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后端")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 user-center-backend:v0.0.1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("虚拟化")]),s._v(" "),a("ol",[a("li",[s._v("端口映射：把本机的资源（实际访问地址）和容器内部的资源（应用启动端口）进行关联")]),s._v(" "),a("li",[s._v("目录映射：把本机的端口和容器应用的端口进行关联")])]),s._v(" "),a("p",[s._v("进入容器：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v("  fee2bbb7c9ee /bin/bash\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("查看进程：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("查看日志：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("container-id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("杀死容器：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("强制删除镜像：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" rmi "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"docker-平台部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-平台部署"}},[s._v("#")]),s._v(" Docker 平台部署")]),s._v(" "),a("ol",[a("li",[s._v("云服务商的容器平台（腾讯云、阿里云）")]),s._v(" "),a("li",[s._v("面向某个领域的容器平台（前端 / 后端微信云托管）"),a("strong",[s._v("要花钱！")])])]),s._v(" "),a("p",[s._v("容器平台的好处：")]),s._v(" "),a("ol",[a("li",[s._v("不用输命令来操作，更方便省事")]),s._v(" "),a("li",[s._v("不用在控制台操作，更傻瓜式、更简单")]),s._v(" "),a("li",[s._v("大厂运维，比自己运维更省心")]),s._v(" "),a("li",[s._v("额外的能力，比如监控、告警、其他（存储、负载均衡、自动扩缩容、流水线）")])]),s._v(" "),a("h2",{attrs:{id:"绑定域名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#绑定域名"}},[s._v("#")]),s._v(" 绑定域名")]),s._v(" "),a("p",[s._v("前端项目访问流程：用户输入网址 => 域名解析服务器（把网址解析为 ip 地址 / 交给其他的域名解析服务） => 服务器 =>（防火墙）=> nginx 接收请求，找到对应的文件，返回文件给前端 => 前端加载文件到浏览器中（js、css） => 渲染页面")]),s._v(" "),a("p",[s._v("后端项目访问流程：用户输入网址 => 域名解析服务器 => 服务器 => nginx 接收请求 => 后端项目（比如 8080端口）")]),s._v(" "),a("p",[s._v("nginx 反向代理的作用：替服务器接收请求，转发请求")]),s._v(" "),a("h2",{attrs:{id:"跨域问题解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域问题解决"}},[s._v("#")]),s._v(" 跨域问题解决")]),s._v(" "),a("p",[s._v("浏览器为了用户的安全，仅允许向 "),a("strong",[s._v("同域名、同端口")]),s._v(" 的服务器发送请求。")]),s._v(" "),a("p",[s._v("如何解决跨域？")]),s._v(" "),a("p",[s._v("最直接的方式：把域名、端口改成相同的")]),s._v(" "),a("h3",{attrs:{id:"添加跨域头"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加跨域头"}},[s._v("#")]),s._v(" 添加跨域头")]),s._v(" "),a("p",[s._v("让服务器告诉浏览器：允许跨域（返回 cross-origin-allow 响应头）")]),s._v(" "),a("h4",{attrs:{id:"_1-网关支持-nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-网关支持-nginx"}},[s._v("#")]),s._v(" 1. 网关支持（Nginx）")]),s._v(" "),a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 跨域配置")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" ^~ /api/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" http://127.0.0.1:8080/api/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Origin'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_origin")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Credentials'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'true'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" Access-Control-Allow-Methods "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GET, POST, OPTIONS'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" Access-Control-Allow-Headers "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ("),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_method")]),s._v(" = "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'OPTIONS'")]),s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Credentials'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'true'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Origin'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_origin")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Methods'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GET, POST, OPTIONS'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Allow-Headers'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Access-Control-Max-Age'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1728000")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'text/plain; charset=utf-8'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Length'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("204")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h4",{attrs:{id:"_2-修改后端服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-修改后端服务"}},[s._v("#")]),s._v(" 2. 修改后端服务")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("配置 @CrossOrigin 注解")])]),s._v(" "),a("li",[a("p",[s._v("添加 web 全局请求拦截器")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Configuration")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebMvcConfg")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebMvcConfigurer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n \n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addCorsMappings")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("CorsRegistry")]),s._v(" registry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//设置允许跨域的路径")]),s._v("\n        registry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/**"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//设置允许跨域请求的域名")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//当**Credentials为true时，**Origin不能为星号，需为具体的ip地址【如果接口不带cookie,ip无需设成具体ip】")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("allowedOrigins")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:9527"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:9527"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:8082"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:8083"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//是否允许证书 不再默认开启")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("allowCredentials")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//设置允许的方法")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("allowedMethods")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//跨域允许时间")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("maxAge")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("定义新的 corsFilter Bean，参考：https://www.jianshu.com/p/b02099a435bd")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);